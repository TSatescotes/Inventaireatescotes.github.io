<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Inventaire Poplab</title>
    <style>
        /* Style général */
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #00b3a3, #ff62a1, #ffef9a);
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-attachment: fixed;
        }
        h1 {
            font-size: 2.5em;
            color: #fff;
            margin-top: 20px;
            text-align: center;
            text-shadow: -2px -2px 0 #333, 2px -2px 0 #333, -2px 2px 0 #333, 2px 2px 0 #333;
        }
        #inventorySection, #addSection {
            display: block;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
            width: 90%;
            max-width: 800px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            text-align: left;
            padding: 10px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f9f9f9;
        }
        .actions {
            display: flex;
            gap: 5px;
        }
        .actions button {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        .edit {
            background-color: #ffa500;
            color: white;
        }
        .delete {
            background-color: #ff4d4d;
            color: white;
        }
        #addSection button {
            margin-top: 10px;
            background: linear-gradient(135deg, #00b3a3, #00d084);
            color: white;
            font-size: 1.2em;
            font-weight: bold;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #addSection button:hover {
            background: linear-gradient(135deg, #00a76d, #00b3a3);
        }
        input[type="text"], input[type="number"] {
            padding: 8px;
            font-size: 1em;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px 0;
            width: calc(100% - 20px);
        }
    </style>
</head>
<body>
    <h1>Inventaire Poplab</h1>
    
    <div id="addSection">
        <h2>Ajouter un nouvel article</h2>
        <input type="text" id="newItemName" placeholder="Nom de l'article">
        <input type="number" id="newItemQuantity" placeholder="Quantité" min="0">
        <button id="addButton">Ajouter</button>
    </div>

    <div id="inventorySection">
        <h2>Inventaire</h2>
        <table id="inventoryTable">
            <thead>
                <tr>
                    <th>Article</th>
                    <th>Quantité</th>
                    <th>Variantes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Les articles seront ajoutés ici dynamiquement -->
            </tbody>
        </table>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const API_URL = "https://api.jsonbin.io/v3/b/673c9a24e41b4d34e456eab6";
            const MASTER_KEY = "$2a$10$C2IpRYDMnBVS09UziRhWsuPTWBDUAY3bghoT9Fz9cORd/9QFWGhiW";
            const ACCESS_KEY = "$2a$10$CK7kuKd1eFHbsVtOb88Jbu4vIKYO5oTKnHfu2t0L.vVU2DP/wHcmW";

            let inventoryItems = [];
            const inventoryTable = document.getElementById("inventoryTable").querySelector("tbody");
            const newItemName = document.getElementById("newItemName");
            const newItemQuantity = document.getElementById("newItemQuantity");
            const addButton = document.getElementById("addButton");

            // Charger l'inventaire depuis JSONBin
            async function loadInventory() {
                try {
                    const response = await fetch(API_URL, {
                        method: "GET",
                        headers: {
                            "X-Access-Key": ACCESS_KEY,
                        },
                    });
                    const data = await response.json();
                    inventoryItems = data.record || [];
                    renderInventory();
                } catch (error) {
                    console.error("Erreur lors du chargement de l'inventaire :", error);
                }
            }

            // Sauvegarder l'inventaire dans JSONBin
            async function saveInventory() {
                try {
                    await fetch(API_URL, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                            "X-Master-Key": MASTER_KEY,
                        },
                        body: JSON.stringify({ record: inventoryItems }),
                    });
                } catch (error) {
                    console.error("Erreur lors de la sauvegarde de l'inventaire :", error);
                }
            }

            // Ajout d'un article
            addButton.addEventListener("click", () => {
                const itemName = newItemName.value.trim();
                const itemQuantity = parseInt(newItemQuantity.value.trim(), 10);

                if (!itemName || isNaN(itemQuantity) || itemQuantity < 0) {
                    alert("Veuillez entrer un nom valide et une quantité.");
                    return;
                }

                const newItem = {
                    id: Date.now(),
                    name: itemName,
                    quantity: itemQuantity,
                    variants: []
                };

                inventoryItems.push(newItem);
                saveInventory();
                renderInventory();
                newItemName.value = "";
                newItemQuantity.value = "";
            });

            // Rendu de l'inventaire
            function renderInventory() {
                inventoryTable.innerHTML = "";
                inventoryItems.forEach(item => {
                    const row = document.createElement("tr");

                    // Article
                    const nameCell = document.createElement("td");
                    nameCell.textContent = item.name;

                    // Quantité
                    const quantityCell = document.createElement("td");
                    quantityCell.innerHTML = `<input type="number" value="${item.quantity}" min="0" class="quantityInput">`;

                    // Variantes
                    const variantsCell = document.createElement("td");
                    if (item.variants.length > 0) {
                        variantsCell.innerHTML = item.variants.map(variant => `
                            <div>
                                ${variant.name} : 
                                <input type="number" value="${variant.quantity}" min="0" class="variantQuantity">
                                <button class="delete deleteVariant">Supprimer</button>
                            </div>
                        `).join("");
                    } else {
                        variantsCell.textContent = "Aucune variante";
                    }
                    const addVariantButton = document.createElement("button");
                    addVariantButton.textContent = "Ajouter une variante";
                    addVariantButton.classList.add("edit");
                    addVariantButton.addEventListener("click", () => {
                        const variantName = prompt("Nom de la variante :");
                        const variantQuantity = parseInt(prompt("Quantité pour la variante :"), 10);
                        if (!variantName || isNaN(variantQuantity) || variantQuantity < 0) {
                            alert("Entrée invalide pour la variante.");
                            return;
                        }
                        item.variants.push({ name: variantName, quantity: variantQuantity });
                        saveInventory();
                        renderInventory();
                    });
                    variantsCell.appendChild(addVariantButton);

                    // Actions
                    const actionsCell = document.createElement("td");
                    actionsCell.classList.add("actions");
                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Supprimer";
                    deleteButton.classList.add("delete");
                    deleteButton.addEventListener("click", () => {
                        if (confirm(`Êtes-vous sûr de vouloir supprimer l'article "${item.name}" ?`)) {
                            inventoryItems = inventoryItems.filter(i => i.id !== item.id);
                            saveInventory();
                            renderInventory();
                        }
                    });
                    actionsCell.appendChild(deleteButton);

                    // Append cells to row
                    row.appendChild(nameCell);
                    row.appendChild(quantityCell);
                    row.appendChild(variantsCell);
                    row.appendChild(actionsCell);

                    inventoryTable.appendChild(row);

                    // Mise à jour des quantités
                    quantityCell.querySelector(".quantityInput").addEventListener("change", (e) => {
                        item.quantity = parseInt(e.target.value, 10) || 0;
                        saveInventory();
                    });

                    variantsCell.querySelectorAll(".variantQuantity").forEach((variantInput, index) => {
                        variantInput.addEventListener("change", (e) => {
                            item.variants[index].quantity = parseInt(e.target.value, 10) || 0;
                            saveInventory();
                        });
                    });

                    variantsCell.querySelectorAll(".deleteVariant").forEach((deleteVariantButton, index) => {
                        deleteVariantButton.addEventListener("click", () => {
                            item.variants.splice(index, 1);
                            saveInventory();
                            renderInventory();
                        });
                    });
                });
            }

            // Charger l'inventaire initialement
            loadInventory();
        });
    </script>
</body>
</html>
